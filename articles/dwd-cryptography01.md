---
title: "æš—å·ã«ã¤ã„ã¦è€ƒãˆã¦ã¿ã‚‹ (1)"
emoji: "ğŸª"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Qiskit", "Python", "poem"]
published: true
---

# ç›®çš„

RSA æš—å·ã¨ Shor ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã¤ã„ã¦éå»ã«æ›¸ã„ãŸè‡ªåˆ†ç”¨ãƒ¡ãƒ¢ãŒè»¢ãŒã£ã¦ã„ãŸã®ã§æ•´ç†ã—ãŸã„ã€‚æ•´ç†ã—ãŸã„ãŒã€æ­£ç›´ã‚ã¾ã‚Šè¦šãˆã¦ã„ãªã„ã®ã§ã€ã¾ãŸãƒ¡ãƒ¢ãŒãªããªã‚‰ãªã„ã‚ˆã†ã«æ›¸ãå‡ºã—ã¦ãŠã“ã†ã¨ã„ã†ç¨‹åº¦ã§ã€å®Ÿé¨“ã®è©³ç´°ã‚‚ã‚ã¾ã‚Šè¦šãˆã¦ã„ãªã„ã€‚æ•…ã«ã€**ã“ã‚Œã¯ç‰©å‡„ã„é©å½“ãªè¨˜äº‹**ã§ã‚ã‚‹ã€‚

# RSA æš—å·

ä»¥ä¸‹ã§è¨€ã„ãŸã„ã“ã¨ã¯ã€ã€Œ**ã¨ã¦ã‚‚å¤§ããª â€œã»ã¼ç´ æ•°â€ ã¨ã—ã¦é–‹ç¤ºã•ã‚Œã¦ã„ã‚‹å…¬é–‹éµãŒç´ å› æ•°åˆ†è§£ã•ã‚Œã‚‹ã¨ã€ç§˜å¯†éµãŒæ¨æ¸¬ã§ãã¦ã—ã¾ã†**ã€ã¨ã„ã†ã“ã¨ã§ã‚ã‚‹ã€‚

æ–‡çŒ® [S] ã‚’å‚è€ƒã«ã—ã‚ˆã†[^1]ã€‚è©³ç´°ã‚’å…¨ã¦å‰²æ„›ã—ã¦ã€ã²ãŸã™ã‚‰è¨˜å·ã ã‘å°å…¥ã™ã‚‹ã€‚

[^1]: æ–‡çŒ® [NC2] ã®ä»˜éŒ² E ã«ã‚‚ä¼¼ãŸã‚ˆã†ãªå†…å®¹ãŒã‚ã‚‹ã€‚

- $p$, $q$ ã‚’ 201 æ¡ä»¥ä¸Šã®ç´ æ•°ã¨ã—ã€éå…¬é–‹ã¨ã™ã‚‹ã€‚
- $N = pq$ ã¨ãŠãã€‚ã“ã‚Œã¯ç´ å› æ•°åˆ†è§£ã®é›£ã—ã„ 400 æ¡ä»¥ä¸Šã®æ•°ã«ãªã‚‹ã€‚
- $L = (p-1) (q-1)$ ã¨ãŠãã€‚$p$ ã¨ $q$ ãŒç‰¹å®šã§ããªã„ã¨ç®—å‡ºã§ããªã„ã€‚
- $\mathcal{M}$: 400 æ¡ä»¥ä¸‹ã®è‡ªç„¶æ•°ã§ $N$ ã¨äº’ã„ã«ç´ ãªã‚‚ã®ã€‚å¹³æ–‡ã®é›†åˆã€‚
- $\mathcal{C}$: 400 æ¡ä»¥ä¸‹ã®è‡ªç„¶æ•°ã§ $N$ ã¨äº’ã„ã«ç´ ãªã‚‚ã®ã€‚æš—å·æ–‡ã®é›†åˆã€‚

æ¬¡ã«å…¬é–‹éµ $\{e, N\}$ ã¨ç§˜å¯†éµ $d$ ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä½œã‚‹:

- $e$: $L$ ã¨äº’ã„ã«ç´ ãªè‡ªç„¶æ•°ã€‚$e > 1$
- $d$: $ed \equiv 1 \mod L$
    - ã“ã® $d$ ã¯ $$ae + b L = 1 \tag{1}$$ ã‚’æº€ãŸã™æ•´æ•° $a$ ã®ä¸­ã‹ã‚‰é©å½“ã«é¸ã¶ã€‚

ã“ã®è¨­å®šä¸‹ã§å…¬é–‹éµ $\{e, N\}$ ã§æš—å·åŒ–ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’é€ã£ã¦ã‚‚ã‚‰ã£ã¦ã€ç§˜å¯†éµ $d$ ã§å¾©å·ã§ãã‚‹ã¨ã„ã†ã‚·ãƒŠãƒªã‚ªã§ã‚ã‚‹ã€‚

æš—å·åŒ–ã¨å¾©å·ã‚’ä»¥ä¸‹ã§å®šã‚ã‚‹:

**æš—å·åŒ–** $E: \mathcal{M} \to \mathcal{C}$

$$
\begin{align*}
E(m) = m^e \mod N
\end{align*}
$$

**å¾©å·** $D: \mathcal{C} \to \mathcal{M}$

$$
\begin{align*}
D(c) = c^d \mod N
\end{align*}
$$

ã¾ãšã„ã®ã¯ã€Œç§˜å¯†éµ $d$ ã‚’æ¨æ¸¬ã—ã¦ä½œã‚‰ã‚Œã¦ã—ã¾ã†ã“ã¨ã€ã§ã‚ã‚‹ã€‚$e$ ã¯å…¬é–‹éµã§èª°ã§ã‚‚åˆ†ã‹ã‚‹ã®ã§ã€Eq. (1) ã‚ˆã‚Šã€$L$ ãŒåˆ†ã‹ã‚‹ã¨ $d$ ã®ã‚¢ã‚¿ãƒªãŒã¤ã„ã¦ã—ã¾ã†ã€‚$L = (p-1) (q-1)$ ã§ $N = pq$ ã§ã‚ã£ãŸã®ã§ã€ã¤ã¾ã‚Šã€Œ**ã‚‚ã†ç‰‡æ–¹ã®å…¬é–‹éµ $N$ ãŒç´ å› æ•°åˆ†è§£ã•ã‚Œã‚‹ã¨ç§˜å¯†éµ $d$ ã®ã‚¢ã‚¿ãƒªãŒã¤ã„ã¦ã—ã¾ã†**ã€ã¨è¨€ã†ã“ã¨ã§ã‚ã‚‹ã€‚

## ä¾‹

ä»Šå›ã¯å‹•ãã ã‘è¦‹ãŸã„ã®ã§ã€å°ã•ãªæ•°ã§è©¦ãã†ã€‚$p=5$, $q=7$ ã¨ã—ã¦ã¿ã‚‹ã€‚ã“ã®æ™‚ã€$N=35$ ã§ã‚ã‚Šã€$L=24$ ã§ã‚ã‚‹ã€‚ã‚‚ã†ç‰‡æ–¹ã®å…¬é–‹éµã¨ç§˜å¯†éµã®ãƒšã‚¢ã¯ã€ä¾‹ãˆã° $(e,d) = (5,5)$ ã§ä½œã‚Œã‚‹ã€‚

Alice ã¯ Bob ã«é‡å¤§ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œ`i_love_you_bob`ã€ã‚’é€ã‚ŠãŸã„ã€‚

```python
N = 35
L = 24
e = 5
d = 5

message = "i_love_you_bob"
enc_text = [(ord(v)-90)**e % N for v in list(message)]
print(enc_text)
```
> [15, 10, 23, 21, 28, 16, 10, 26, 21, 27, 10, 8, 21, 8]

æš—å·åŒ–[^2]ã«ã‚ˆã‚Šè¬ã®æ•°åˆ—ãŒã§ããŸã€‚ã“ã‚Œã‚’å¾©å·ã—ã‚ˆã†ã€‚

[^2]: ä»Šå›å°ã•ã„éµã§è©¦è¡Œã—ã¦ã„ã‚‹ãŸã‚ã€æš—å·åŒ–ã—ã¦å¾©å·ã§ãã‚‹æ–‡å­—ã®é›†åˆãŒå°ã•ã„ã€‚ã‚ˆã£ã¦ã€ç¯„å›²ã«å…¥ã‚‹ã‚ˆã†ã«é©å½“ã«ã‚ªãƒ•ã‚»ãƒƒãƒˆ $90$ ã‚’ã‹ã¾ã—ã¦ã„ã‚‹ã€‚

```python
dec_text = "".join([chr((v**d % N) + 90) for v in enc_text])
print(dec_text)
```
> i_love_you_bob

å…ƒã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¾©å…ƒã•ã‚ŒãŸã€‚ã“ã‚Œã¯**å¤§äº‹ãªå†…å®¹**ãªã®ã§ã€é€”ä¸­ã§æ”»æ’ƒã•ã‚ŒãŸããªã„ã‚ã‘ã§ã‚ã‚‹ã€‚

# $n$ æ¡ã®æ•´æ•°ã®ç´ å› æ•°åˆ†è§£

ä¾‹ãˆã°æ–‡çŒ® [NC2] p.103 ã«ã‚ˆã‚‹ã¨ã€æ–‡çŒ® [L] ã«è§£èª¬ãŒã‚ã‚‹ Lenstra ã«ã‚ˆã‚‹ææ¡ˆã•ã‚ŒãŸã€Œæ•°ä½“ç¯©æ³• (ã™ã†ãŸã„ãµã‚‹ã„ã»ã†)ã€ã¨ã„ã†ã‚‚ã®ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ä¸­ã§ã¯å¤§å¤‰é«˜é€Ÿãªç´ å› æ•°åˆ†è§£ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã®ã“ã¨ã§ã‚ã‚‹ã€‚æ–‡çŒ® [Q] ã«ã‚ˆã‚‹ã¨ã€

$$
\begin{align*}
O \left( \exp \left[ \frac{64}{9} n (\log n)^2 \right]^{1/3} \right)
\end{align*}
$$

ã¨ã„ã†æº–æŒ‡æ•°é–¢æ•°çš„ãªè¨ˆç®—é‡ã«ãªã‚‹ãã†ã§ã‚ã‚‹ã€‚å…¬é–‹éµ$N$ ã¯ 400 æ¡ä»¥ä¸ŠãŒæƒ³å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ã€æ•°ä½“ç¯©æ³•ã§ç´ å› æ•°åˆ†è§£ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã¨ã¦ã‚‚ã§ã¯ãªã„ãŒè¨ˆç®—ãŒçµ‚ã‚ã‚‰ãªã„ãƒ»ãƒ»ãƒ»ã¨ã„ã†ã“ã¨ã«ãªã‚‹ (ã¯ãš)ã€‚å¯¾ã—ã¦ã€é‡å­è¨ˆç®—ã‚’æ´»ç”¨ã—ãŸ Shor ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ $n$ ã«å¯¾ã—ã¦å¤šé …å¼æ™‚é–“ã§ç´ å› æ•°åˆ†è§£å•é¡Œã‚’è§£ã‘ã‚‹ã¨ã®ã“ã¨ã§ã‚ã‚‹ã€‚

**ç¾å®Ÿçš„ãªæ™‚é–“ã§ç´ å› æ•°åˆ†è§£ã§ããªã„ã¨ã„ã†å‰æã®ã‚‚ã¨ã§è¨­è¨ˆã•ã‚ŒãŸæš—å·æ–¹å¼ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã‚ã£ãŸã®ã§ã€ç¾å®Ÿçš„ãªæ™‚é–“ã§è§£ã‹ã‚Œã‚‹ã¨æ ¹åº•ãŒå´©ã‚Œã‚‹**ã‚ã‘ã§ã‚ã‚‹ã€‚

# Shor ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

æŠ˜è§’ãªã®ã§ã€æ–‡çŒ® [S] ã«å¾“ã„ãªãŒã‚‰ 35 ã‚’ç´ å› æ•°åˆ†è§£ã—ãŸã„[^3]ã€‚Alice ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ”»æ’ƒã‚’å—ã‘ã¦ã—ã¾ã†ã®ã§ã‚ã‚ã†ã‹ï¼Ÿ

[^3]: ç›¸å½“ãªã‚¤ãƒ³ãƒã‚­ã‚’ã™ã‚‹ãŒã€ã‚ˆãã‚ã‚‹ 15 ã®ç´ å› æ•°åˆ†è§£ã‚ˆã‚Šã¯ä½•ã‹ã‚„ã£ã¦ã„ã‚‹æ°—æŒã¡ã«ãªã‚Œãã†ãªæ°—ãŒã™ã‚‹ã€‚

ç´°ã‹ã„ã“ã¨ã¯æ–‡çŒ® [S] ã«æ›¸ã„ã¦ã‚ã‚‹ã®ã§ã€ã“ã“ã§ã¯ã–ã£ã¨æµã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªé‡å­å›è·¯ã‚’å®Ÿè£…ã™ã‚‹ã€‚

![](/images/dwd-cryptography01/001.png)

ä»Šå›ã¯è¨ˆç®—ã®éƒ½åˆã§ã€çªå¦‚ $a=9$ ã¨ã„ã† $N=35$ ã¨ç´ ã§ã‚ã‚‹ã‚ˆã†ãªæ•°å­—ãŒ**å¶ç„¶ã«ã‚‚**é¸ã°ã‚Œã¦ã€$a^r \equiv 1 \mod N$ ã¨ãªã‚‹ $a$ ã® â€œå‘¨æœŸâ€ ã‚’æ±‚ã‚ã‚‹ã“ã¨ã«ãªã‚‹ã€‚ã“ã‚ŒãŒãã®å›è·¯ã§ã‚ã‚‹ã€‚æ–‡çŒ® [NC2] p.85 è¾ºã‚Šã«ã‚ˆã‚‹ã¨ $\gcd(a^{r/2}-1, N)$ ã¾ãŸã¯ $\gcd(a^{r/2}+1, N)$ ãŒ $N$ ã®ç´ å› æ•°ã®å¯èƒ½æ€§ãŒé«˜ã„ã¨ã„ã†è©±ã§ã‚ã‚‹ã€‚

## çªç„¶ã€é‡å­ä½ç›¸æ¨å®š

ã•ã¦ã€ä¸Šè¨˜ã®é‡å­å›è·¯è‡ªä½“ã¯ã‚ã‚‹ãƒ¦ãƒ‹ã‚¿ãƒªã‚²ãƒ¼ãƒˆ $U$ ã«å¯¾ã™ã‚‹å›ºæœ‰å€¤ã‚’æ±‚ã‚ã‚‹é‡å­ä½ç›¸æ¨å®šã®å›è·¯ã§ã‚ã‚‹ã€‚é‡å­ä½ç›¸æ¨å®šã¨ã„ã†ã‚„ã¤ã¯ã€$U$ ã®å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ« $\ket{\psi}$ ã«å¯¾å¿œã™ã‚‹å›ºæœ‰å€¤ $\exp(2 \pi i \theta)$ ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã¨ã„ã†ã‚‚ã®ã§ã‚ã£ãŸ:

$$
\begin{align*}
U \ket{v} = \exp(2 \pi i \theta) \ket{\psi}
\end{align*}
$$

ã“ã“ã§ã€é‡å­ä½ç›¸æ¨å®šã®å›è·¯ã¯ã€$\ket{0}^{\otimes n} \ket{\psi}$ ã§åˆæœŸåŒ–ã•ã‚ŒãŸçŠ¶æ…‹ã«å¯¾ã—ã¦ã€å‰åŠã®éšæ®µçŠ¶ã®ã‚²ãƒ¼ãƒˆã‚’é©ç”¨ã™ã‚‹ã¨ã€**å½¢å¼çš„ã«ã¯** $(\operatorname{QFT}\ket{\theta}) \otimes \ket{\psi}$ ã«ãªã‚‹ã¨ã„ã†å·§ã¿ãªå›è·¯ã ã€‚ã“ã“ã§ã€$\operatorname{QFT}$ ã¯é‡å­ Fourier å¤‰æ›ã§ã‚ã‚‹ã€‚ã‚ˆã£ã¦ã€ã“ã®çŠ¶æ…‹ã® â€œä¸Šã®éƒ¨åˆ†â€ ã«é€†é‡å­ Fourier å¤‰æ›ã‚’ä½œç”¨ã•ã›ã‚‹ã¨ã€$(\operatorname{QFT}^{-1} \otimes I) ((\operatorname{QFT}\ket{\theta}) \otimes \ket{\psi}) = \ket{\theta} \times \ket{\psi}$ ã¨ãªã‚‹ã®ã§ã€â€œä¸Šã®éƒ¨åˆ†â€ ã‚’æ¸¬å®šã™ã‚‹ã¨ $\theta$ ãŒæ±‚ã¾ã‚‹ã¨ã„ã†ã‚«ãƒ©ã‚¯ãƒªã§ã‚ã‚‹ã€‚ãªãŠã€å®Ÿéš›ã«ã¯ $\theta$ ã® 2 é€²å±•é–‹ã®è¿‘ä¼¼å€¤ãŒæ±‚ã¾ã‚‹å½¢ã§ã€$H$ ã‚²ãƒ¼ãƒˆã‚’é©ç”¨ã—ã¦ã„ã‚‹é‡å­ãƒ“ãƒƒãƒˆã®å€‹æ•° $n$ ãŒ 2 é€²æ•°ã¨ã—ã¦ã®æ¡æ•°ã«å¯¾å¿œã™ã‚‹ã€‚

## é–‘è©±ä¼‘é¡Œã€Shor ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

ã§ã¯ã€ä¸Šè¨˜ã®é‡å­ä½ç›¸æ¨å®šã®å›è·¯ã¯ã©ã†ã„ã†ãƒ¦ãƒ‹ã‚¿ãƒªã‚²ãƒ¼ãƒˆã®å›ºæœ‰å€¤ã‚’æ±‚ã‚ã¦ã„ã‚‹ã®ã‹ï¼Ÿãã—ã¦å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ãŒã©ã†ã‚„ã£ã¦æ±‚ã¾ã‚‹ã®ã‹ï¼Ÿã¨ã„ã†è©±ã§ã‚ã‚‹ã€‚

ã•ã¦ã€æ–‡çŒ® [S] ã‹ã‚‰ç­”ãˆã‚’å¼•ã£å¼µã£ã¦ãã‚‹ã¨ã€$U$ ã¯çŠ¶æ…‹ãƒ™ã‚¯ãƒˆãƒ« $\ket{y}$ ã«å¯¾ã—ã¦

$$
\begin{align*}
U \ket{y} = \ket{ay \mod N}
\end{align*}
$$

ã‚’å‡ºåŠ›ã™ã‚‹ç›¸å½“ã«ãƒˆãƒªãƒƒã‚­ãƒ¼ãªã‚²ãƒ¼ãƒˆã§ã‚ã‚‹ã€‚$a^r \equiv 1 \mod N$ ãªã®ã§ã€$a$ ã¯ä¸€ç¨®ã® ã€Œ1 ã®å†ªæ ¹ã€ã¿ãŸã„ãªæ‰±ã„ãªã®ã ã‚ã†ã‹ï¼Ÿã¨ã«ã‹ããã‚Œã‚’ â€œæ›ã‘ã‚‹â€ ã®ãŒ $U$ ã¨ã„ã†ãƒ¦ãƒ‹ã‚¿ãƒªã‚²ãƒ¼ãƒˆã ã€‚

ã“ã‚“ãªã‚‚ã®ã®å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ãªã©äº‹å‰ã«åˆ†ã‹ã‚‹ã‚ã‘ãŒãªã„ãƒ»ãƒ»ãƒ»æ°—ã‚‚ã™ã‚‹ã®ã ãŒã€$s \in \{0, 1, \ldots, r-1\}$ ã«å¯¾ã—ã¦ã‚ã‚‹ $\ket{u_s}$ ã‚’å®šã‚ã‚‹ã¨[^4]ã€ã“ã‚ŒãŒä½•ã¨ã†ã¾ã„ã“ã¨å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ã«ãªã£ã¦ã—ã¾ã„ã€

[^4]: $$
\begin{align*} \ket{u_s} := \frac{1}{\sqrt{r}} \sum_{k=0}^{r-1} \exp\left(- \frac{2 \pi i s k}{r}\right) \ket{a^k \mod N} \end{align*}
$$

$$
\begin{align*}
U \ket{u_s} = \exp\left(2 \pi i \frac{s}{r}\right) \ket{u_s}
\end{align*}
$$

ã‚’æº€ãŸã™ã€‚ã“ã® $\ket{u_s}$ ãŒã‚ã‚‹ $s = s_0 \neq 0$ ã«ã¤ã„ã¦ç›´æ¥é‡å­å›è·¯ä¸Šã«æº–å‚™ã§ãã‚‹ã®ã§ã‚ã‚Œã°ã€é‡å­ä½ç›¸æ¨å®šã§ $s_0/r$ ãŒæ±‚ã¾ã‚‹ã®ã§è‰¯ã„ãŒã€æœªçŸ¥ã® $r$ ã‚‚å…¥ã£ã¦ã„ã‚‹ã—å°‘ã€…å³ã—ã„ (ãã‚‚ãã‚‚åˆ†æ¯ãƒ»åˆ†å­ã«å®šæ•°å€ã®æºã‚‰ããŒã‚ã‚‹)ã€‚ã¨ã“ã‚ãŒå®Ÿã¯

$$
\begin{align*}
\frac{1}{\sqrt{r}} \sum_{s=0}^{r-1} \ket{u_s} = \ket{1}
\end{align*}
$$

ã¨ãªã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã€ã“ã®å³è¾ºã®çŠ¶æ…‹ $\ket{1}$ ã¯å®¹æ˜“ã«é‡å­å›è·¯ä¸Šã«æº–å‚™ã§ãã‚‹ã€‚

ã‹ãã—ã¦é‡å­å›è·¯ã® â€œä¸‹å´â€ ã« $\ket{1}$ ã‚’æº–å‚™ã—ã¦[^5] $U$ ã«å¯¾ã™ã‚‹é‡å­ä½ç›¸æ¨å®šã‚’è¡Œã†ã¨ã€$\ket{1}$ ã‚’æ§‹æˆã™ã‚‹å„å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ã®ã€Œå›ºæœ‰å€¤ã®ä½ç›¸ã®ï¼ˆ2 é€²æ•°ã«ã‚ˆã‚‹ï¼‰è¿‘ä¼¼å€¤ã€ãŒç¢ºç‡çš„ã«è¦³æ¸¬ã•ã‚Œã‚‹ (å¾Œè¿°ã® Eq. (2) å‚ç…§)ã€‚

[^5]: ä¸Šè¨˜ã®é‡å­å›è·¯ã®å·¦ã« $X$ ã‚²ãƒ¼ãƒˆãŒã„ã‚‹ã®ã¯ãã†ã„ã†ã“ã¨ã§ã‚ã‚‹ã€‚

ã¤ã¾ã‚Šã€ç¢ºç‡çš„ã« $s/r \ (s \in \{0, 1, \ldots, r-1\})$ ã®è¿‘ä¼¼å€¤ãŒè¦³æ¸¬ã•ã‚Œã‚‹ã€‚å¹¾ã‚‰ã‹æ¸¬å®šã™ã‚‹ä¸­ã§ã€å…±é€šã™ã‚‹åˆ†æ¯ã®ã‚¢ã‚¿ãƒªãŒã¤ã‘ã°è‰¯ã„ã¨ã„ã†ã“ã¨ã§ã‚ã‚‹ã€‚

å°‘ã—ã‚¤ãƒ³ãƒã‚­ãªå¼ã§æ›¸ãã¨ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã ã‚ã†ã‹ã€‚

$$
\begin{align*}
\ket{0}^{\otimes n} \ket{1} &= \ket{0}^{\otimes n} \left( \frac{1}{\sqrt{r}} \sum_{s=0}^{r-1} \ket{u_s} \right) \\
&= \frac{1}{\sqrt{r}} \sum_{s=0}^{r-1} \ket{0}^{\otimes n}\ket{u_s} \\
&\xrightarrow[]{\text{QPE}} \frac{1}{\sqrt{r}} \sum_{s=0}^{r-1} \ket{\theta_s}\ket{u_s}
\tag{2}
\end{align*}
$$

ã“ã“ã§ã€$\theta_s = s/r$ ã§ã‚ã‚‹ã€‚ã‚ˆã£ã¦ã€ä¸Šä½ $n$ ãƒ“ãƒƒãƒˆã¯ä½ç›¸ $\theta_s$ï¼ˆã®è¿‘ä¼¼å€¤ï¼‰ãŒé‡ã­åˆã‚ã•ã£ãŸã‚ˆã†ãªçŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã€‚

# å®Ÿè£…

å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ import ã™ã‚‹ã€‚ä»¥ä¸‹ã€æœ¬è³ªçš„ã«ã¯æ–‡çŒ® [S] ã®ã¾ã¾ã§ã‚ã‚‹ã€‚

```python
import time
import matplotlib.pyplot as plt
import numpy as np
from qiskit import QuantumCircuit, transpile
from qiskit.visualization import plot_histogram
from qiskit.circuit.library import QFT
from qiskit_aer import AerSimulator
from math import gcd
from fractions import Fraction
```

ã€Œ$9 \mod 35$ ã‚’ â€œæ›ã‘ç®—â€ ä½œç”¨ã•ã›ã‚‹ã‚²ãƒ¼ãƒˆ $U$ã€ã®ä»»æ„ã® $s$ ä¹— $U^s$ ã®åˆ¶å¾¡ã‚²ãƒ¼ãƒˆç‰ˆ $C-U^s$ ã‚’å®Ÿè£…ã™ã‚‹ã€‚(ä¸€æ—¦è©³ç´°ã¯çœç•¥)

```python
def ctrl_9_mod35(power):
    ...
    return c_U
```

$U$ ã«å¯¾ã™ã‚‹ä½ç›¸æ¨å®šã‚’è¡Œã†å›è·¯ã‚’å®Ÿè£…ã™ã‚‹ ($a=9$)ã€‚

```python
def qpe_amod35():
    n_count = 8  # QPE ã®ç²¾åº¦
    qc = QuantumCircuit(6+n_count, n_count)
    for q in range(n_count):
        qc.h(q)

    qc.x(n_count)  # |1> ã®æº–å‚™
    for q in range(n_count):  # é‡å­ä½ç›¸æ¨å®šå‰åŠã®éšæ®µ
        qc.append(ctrl_9_mod35(2**q),
                 [q] + [i+n_count for i in range(6)])

    iqft_circuit = QFT(n_count).inverse()  # é‡å­ä½ç›¸æ¨å®šå¾ŒåŠã® IQFT
    qc.append(iqft_circuit, range(n_count))

    qc.measure(range(n_count), range(n_count))
    aer_sim = AerSimulator()
    job = aer_sim.run(transpile(qc, aer_sim), shots=1, memory=True)
    readings = job.result().get_memory()
    phase = int(readings[0],2)/(2**n_count)

    return phase
```

é‡å­ä½ç›¸æ¨å®šå®Ÿè¡Œã€‚

```python
a = 9
factor_found = False
attempt = 0
while not factor_found:
    attempt += 1
    print("\nAttempt %i:" % attempt)
    phase = qpe_amod35(a) # ä½ç›¸ = s/r
    frac = Fraction(phase).limit_denominator(35)
    r = frac.denominator  # s/r ã®åˆ†æ¯ r ã¯ã“ã‚Œã ã‚ã†ã¨ã„ã†å€¤
    print("Result: r = %i" % r)
    if phase != 0:
        # å› æ•°ã‚’gcd(x^{r/2} Â±1 , 15)ã‹ã‚‰æ¨å®š
        guesses = [gcd(a**(r//2)-1, 35), gcd(a**(r//2)+1, 35)]
        print("Guessed Factors: %i and %i" % (guesses[0], guesses[1]))
        for guess in guesses:
            if guess != 1 and (35 % guess) == 0: # æ¨å®šã—ãŸå› æ•°ãŒæ­£ã—ã„ã‹ç¢ºèª
                print("*** Non-trivial factor found: %i ***" % guess)
                factor_found = True
```

> Attempt 1:
> Register Reading: 11010110
> Corresponding Phase: 0.8359375
> Result: r = 6
> Guessed Factors: 7 and 5
> *** Non-trivial factor found: 7 ***
> *** Non-trivial factor found: 5 ***

ï¼ˆä½•åº¦ã‹ã‚„ã‚Šç›´ã—ã¦ï¼‰$5$ ã¨ $7$ ã¨ã„ã†ç´ å› æ•°ãŒå¾—ã‚‰ã‚ŒãŸã€‚

ã‚ˆã£ã¦ã€**Alice ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯é€”ä¸­ã§æ”»æ’ƒã‚’å—ã‘ã¦è§£èª­ã•ã‚Œã¦ã—ã¾ã£ãŸ**ãƒ»ãƒ»ãƒ»ã‹ã‚‚ã—ã‚Œãªã„ã€‚

## ã‚ªãƒã‚±ï¼ˆã‚¤ãƒ³ãƒã‚­ãª `ctrl_9_mod35` ã®å®Ÿè£…ï¼‰

ã©ã†ã„ã†å€¤ã‚’è¿”ã›ã°è‰¯ã„ã®ã‹åˆ†ã‹ã£ã¦ã„ã‚‹ã®ã§ã€é›°å›²æ°—ã‚’è¦‹ã‚‹ã ã‘ãªã‚‰å®Ÿè³ªãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ã¦ä½œã£ã¦ã—ã¾ãˆã°è‰¯ã„[^6]:

[^6]: ãŠæ‰‹è»½ãªå®Ÿè£…ã«ã§ãã‚‹ã®ãŒ $a=9$ ã ã£ãŸã®ã§ã€9 ã‚’é¸ã‚“ã ã®ã§ã‚ã‚‹ã€‚

```python
def ctrl_9_mod35(power):
    # 9 -> 11 -> 29 -> 16 -> 4 -> 1
    power_ = power%6
    pow2val = {0:1, 1:9, 2:11, 3:29, 4:16, 5:4}
    U = QuantumCircuit(6)
    U.x(0)
    for i, b in enumerate(bin(pow2val[power_])[::-1]):
        if b == '1':
            U.x(i)
    U = U.to_gate()
    U.name = f"9^{power} mod 35"
    c_U = U.control()
    return c_U
```

# ã¾ã¨ã‚

ç›¸å½“ã«ã§ãŸã‚‰ã‚ãªè¨˜äº‹ã§ã€æ‰‹å…ƒã®ãƒ¡ãƒ¢ã®ç™ºæ˜ãŒãƒ¡ã‚¤ãƒ³ãªã®ã§å†…å®¹ã¯å¤§å¤‰å¾®å¦™ã ãŒã€ã¨ã‚Šã‚ãˆãšå†™çµŒã¯ã§ããŸæ°—ãŒã™ã‚‹ã€‚ã‚ã‚„ã—ã„éƒ¨åˆ†ã¯è¿½ã€…è¿½è¨˜ãªã‚Šã—ã¦ã„ããŸã„ãƒ»ãƒ»ãƒ»ã€‚

ã¨ã«ã‹ãã€RSA æš—å·ãŒç ´ã‚‰ã‚Œã¦ã—ã¾ã†ã®ã§ã¯ï¼Ÿã¨ã„ã†å†…å®¹ã§ã‚ã‚‹ã€‚

# å‚è€ƒæ–‡çŒ®

[S] [æ¾¤ç”°ç§€æ¨¹, æš—å·ç†è«–ã¨ä»£æ•°å­¦, æµ·æ–‡å ‚å‡ºç‰ˆ, 1997.](https://www.kaibundo.jp/1997/01/72330/)  
[NC2] [é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¨é‡å­é€šä¿¡II ï¼é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¨ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼](https://shop.ohmsha.co.jp/shop/shopdetail.html?brandcode=000000006440)  
[L] A. K. Lenstra and H. W. Lenstra, Jr. The development of the number field sieve. Lecture Notes in Mathematics, vol.1554. Springer-Verlag, Berlin, 1993.  
[Q] [Quantum Native Dojo ï¼ ä½ç›¸æ¨å®šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆå…¥é–€ç·¨ï¼‰](https://dojo.qulacs.org/ja/latest/notebooks/2.4_phase_estimation_beginner.html)  
[S] [Qiskit Textbook (beta) ï¼ ã‚·ãƒ§ã‚¢ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ](https://github.com/Qiskit/platypus/blob/main/translations/ja/v2/ch-algorithms/shor.ipynb)
