---
title: "è¡Œåˆ—ç©çŠ¶æ…‹ã«ã¤ã„ã¦è€ƒãˆã‚‹ (3)"
emoji: "ğŸ“ˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["math", "Python"]
published: true
---

# ç›®çš„

è¡Œåˆ—ç©çŠ¶æ…‹ (Matrix Product State; MPS) ã«ã¤ã„ã¦ä»¥å‰ã«æ›¸ã„ãŸ [è¡Œåˆ—ç©çŠ¶æ…‹ã«ã¤ã„ã¦è€ƒãˆã‚‹ (2)](/derwind/articles/dwd-matrix-product02) ã®ç¶šãã¨ã—ã¦ã€ã‚‚ã£ã¨ä¸€èˆ¬ã®ãƒ†ãƒ³ã‚½ãƒ«ã§ã® Tensor-Train åˆ†è§£ (é‡å­åŒ–å­¦ã®åˆ†é‡ãªã©ã§ã®å‘¼ç§°ã¯ MPS) ã‚’è€ƒãˆãŸã„ã€‚

è¦ã™ã‚‹ã« [SIAM J. Sci. Comput., 33(5), 2295â€“2317. (23 pages) Tensor-Train Decomposition, I. V. Oseledets](https://www.researchgate.net/publication/220412263_Tensor-Train_Decomposition) ã®å†…å®¹ã‚’å®Ÿè£…ã—ãŸã„ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã€‚

# TT-åˆ†è§£ (Tensor-Train åˆ†è§£)

ä¸€èˆ¬ã« $A(i_1,i_2, \cdots, i_d) \ \ (1 \leq i_k \leq n_k)$ ã‚’è¦ç´ ã«æŒã¤ã‚ˆã†ãª $d$-éšã®ãƒ†ãƒ³ã‚½ãƒ«ãŒä¸ãˆã‚‰ã‚ŒãŸæ™‚ã«ã€ãã®å„è¦ç´ ãŒ

$$
\begin{align*}
A(i_1,i_2, \cdots, i_d) = \sum_{\alpha_0,\cdots,\alpha_{d-1},\alpha_d} G_1(\alpha_0,i_1,\alpha_1) G_2(\alpha_1,i_2,\alpha_2) \cdots G_d(\alpha_{d-1},i_d,\alpha_d)
\end{align*}
$$

ã¨ãªã‚‹ã‚ˆã†ãª 3 éšã®ãƒ†ãƒ³ã‚½ãƒ«ã®åˆ— $\{ G_1, G_2, \cdots, G_d \}$ ã‚’æ±‚ã‚ãŸã„ã¨è¨€ã†ã‚‚ã®ã«ãªã‚‹ã€‚å„ $G_k(\alpha_{k-1},i_k,\alpha_k)$ ã¯æ¬¡å…ƒã¨ã—ã¦ $r_{k-1} \times n_k \times r_k$ ã‚’æŒã¤ 3 éšã®ãƒ†ãƒ³ã‚½ãƒ«ã§ã€ã€Œã‚³ã‚¢ãƒ†ãƒ³ã‚½ãƒ«ã€ã¨å‘¼ã°ã‚Œã‚‹ã€‚$r_k$ ã¯éš£æ¥ã™ã‚‹ã‚³ã‚¢ãƒ†ãƒ³ã‚½ãƒ«ã¨ã®é–“ã®æ¬¡å…ƒã§ã‚ã‚Šã€Œçµåˆæ¬¡å…ƒã€ã¨å‘¼ã°ã‚Œã‚‹ã€‚ä½†ã—ã€â€œå¢ƒç•Œæ¡ä»¶â€ ã¨ã—ã¦ $r_0 = r_d = 1$ ã‚’èª²ã™ã€‚

ã“ã‚Œã¯æ–‡çŒ® [The density-matrix renormalization group in the age of matrix product states](https://arxiv.org/abs/1008.3477) ã¨è¨˜å·ã‚’åˆã‚ã›ã‚‹ãªã‚‰

$$
\begin{align*}
A_{i_1 i_2 \cdots i_d} = \sum_{\alpha_0,\cdots,\alpha_{d-1},\alpha_d} G^{i_1}_{\alpha_1} G^{i_2}_{\alpha_1,\alpha_2} \cdots G^{i_d}_{\alpha_{d-1}}
\end{align*}
$$

ã¨æ›¸ã„ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚ã“ã¡ã‚‰ã®ã»ã†ã¯ã‚ˆã‚Šã€Œè¡Œåˆ—ç©ã€æ„ŸãŒå‡ºãã†ãªæ°—ãŒã™ã‚‹ã€‚ã“ã¡ã‚‰ã®è«–æ–‡ã§ã¯ã€é‡å­çŠ¶æ…‹ã‚’è¨ˆç®—åŸºåº•ã«ã¤ã„ã¦æ›¸ãä¸‹ã—ãŸæ™‚ã« $\ket{0}^{\otimes n}$ ã‹ã‚‰ $\ket{1}^{\otimes n}$ ã¾ã§ã® $2^n$ å€‹ã®åŸºåº•ãƒ™ã‚¯ãƒˆãƒ«ã®ä¿‚æ•°ã€å³ã¡ç¢ºç‡æŒ¯å¹…ã‚’é›†ã‚ã¦ãã¦ä½œã£ãŸæ•°åˆ— (æˆ–ã¯ãƒ™ã‚¯ãƒˆãƒ«) ã‚’ `reshape` ã—ã¦ãƒ†ãƒ³ã‚½ãƒ«ã¨ã¿ãªã—ã€ã“ã‚Œã‚’ TT-åˆ†è§£ã™ã‚‹ã¨ã„ã†å†…å®¹ã«ãªã£ã¦ã„ã‚‹ã€‚

TT-åˆ†è§£ã®è¨¼æ˜è‡ªä½“ã¯ Theorem 2.1 ã«ã¦ SD (Skeleton decomposition) ã¨ã„ã†è¡Œåˆ—åˆ†è§£ã‚’ç”¨ã„ã¦æ§‹æˆçš„ã«ãªã•ã‚Œã‚‹ã€‚ã¾ãŸã€ã“ã‚Œè‡ªä½“ã¯å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ã‚’å®Œå…¨ã«å¾©å…ƒã™ã‚‹å³å¯†ãªåˆ†è§£ã§ã‚ã‚‹ãŒã€è¿‘ä¼¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã—ã¦ã® TT-SVD ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’èª˜å°ã™ã‚‹ã€‚çµåˆæ¬¡å…ƒã‚’çµã‚Šè¾¼ã‚€ã“ã¨ã§æƒ…å ±åœ§ç¸®ã‚’ã—ãªãŒã‚‰å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ã‚’è¿‘ä¼¼ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚

ã“ã® TT-SVD ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è‡ªä½“ã¯è«–æ–‡ã® p.2301 ã«æ²è¼‰ã•ã‚Œã¦ã„ã‚‹ã€‚

# å®Ÿè£…ä¾‹ (Qiita è¨˜äº‹ã‚ˆã‚Š)

ã•ã¦ã€å®Ÿã¯ã“ã® TT-SVD ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã¤ã„ã¦ã®å®Ÿè£…ä¾‹ãŒæ—¢ã«å­˜åœ¨ã—ã¦ã„ã¦ã€ãã‚Œã¯ [Rã§tensor train decomposition ã—ã¦ã¿ãŸ](https://qiita.com/Yh_Taguchi/items/0be41d2b1c0bd8ea0e6b) ã« R è¨€èªã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ã€‚

R è¨€èªã¯å…¨ãçŸ¥ã‚‰ãªã„ã®ã§ã€ã“ã“ã¯ AI ãƒ‘ãƒ¯ãƒ¼ã«ã™ãŒã‚‹ã¨ã„ã†å½¢ã§ GitHub Copilot ã®è¨€èªå¤‰æ›æ©Ÿèƒ½ã‚’è©¦ã—ã¦ã¿ãŸã€‚å°‘ã€…ç²—ã¯ã‚ã£ãŸã®ã ãŒã€å¤šå°‘ã®æ‰‹ç›´ã—ã‚’ã—ãŸçµæœã® Python ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹:

```python
from __future__ import annotations

from typing import Sequence
import numpy as np


def TT(x: np.ndarray, r: Sequence[int]):
    D = x.shape
    n = len(D)

    LIST = [None] * n
    for i in range(n-1):
        if i == 0:
            l0 = 1
        else:
            l0 = r[i-1]
        l1 = r[i]
        x = np.reshape(x, (D[i] * l0, np.prod(D[i+1:n])))
        U, _, _ = np.linalg.svd(x, full_matrices=False)
        LIST[i] = np.reshape(U[:, :l1], (l0, D[i], l1))
        x = np.transpose(U[:, :l1]).dot(x)
    LIST[n-1] = np.transpose(x)
    LIST[0] = np.reshape(LIST[0], (D[0], r[0]))
    return LIST
```

é›°å›²æ°—çš„ã«ä¼¼ã¦ã„ã‚‹ã‹ãªï¼Ÿã¨æ€ã£ãŸã®ãŒåˆè¦‹ã®å°è±¡ã§ã‚ã£ãŸã€‚

ç¶šã‘ã¦ã€åŒ Qiita ã®è¨˜äº‹ã®å®Ÿé¨“ã‚’å†ç¾ã—ã¦ã¿ãŸã„ã€‚R ã®å¤šæ¬¡å…ƒé…åˆ—ã®èª­ã¿æ–¹ãŒåˆ†ã‹ã‚‰ãªãã¦è©¦è¡ŒéŒ¯èª¤ã—ãŸãŒã€çµå±€ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«èª­ã¿æ›ãˆãŸã‚‰è‰¯ã‹ã£ãŸã‚ˆã†ã§ã‚ã‚‹ã€‚

```python
Z = np.array([
    [
        [1.262954, -1.1476570, -0.05710677, 0.9921604, 0.83204713],
        [1.272429, -0.4115108, -0.69095384, -0.2793463, -0.37670272],
        [-0.928567, 0.4356833, -0.23570656, -0.4527840, -0.05487747],
        [2.404653, 0.3773956, -0.64947165, -1.0655906, -0.17262350],
    ],
    [
        [-0.3262334, -0.2894616, 0.5036080, -0.4295131, -0.2273287],
        [0.4146414, 0.2522234, -1.2845994, 1.7579031, 2.4413646],
        [-0.2947204, -1.2375384, -0.5428883, -0.8320433, 0.2501413],
        [0.7635935, 0.1333364, 0.7267507, -1.5637821, -2.2239003],
    ],
    [
        [1.329799263, -0.2992151, 1.08576936, 1.2383041, 0.2661374],
        [-1.539950042, -0.8919211, 0.04672617, 0.5607461, -0.7953391],
        [-0.005767173, -0.2242679, -0.43331032, -1.1665705, 0.6182433],
        [-0.799009249, 0.8041895, 1.15191175, 1.1565370, -1.2636144],
    ],
])
```

å› ã¿ã«ã“ã®è¨˜äº‹ã§ã¯çµåˆæ¬¡å…ƒã‚’ `c(2,3)` ã§ä¸ãˆã¦ã„ã‚‹ãŒã€å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ãŒå°ã•ã„ã®ã§ã€çµæ§‹å½±éŸ¿ã‚’å—ã‘ã¦ã—ã¾ã„ã€è¿‘ä¼¼å€¤ã®ã‚ˆã†ãªè¿‘ä¼¼å€¤ã¨ã‚‚è¨€ãˆãªã„ã‚ˆã†ãªãƒ†ãƒ³ã‚½ãƒ«ãŒå¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã§ã‚ã‚‹ã€‚`c(3,4)` ãã‚‰ã„ãŒã¾ãã¾ãè¿‘ä¼¼å€¤ã§ã€`c(3,5)` ã§å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ãŒå¾©å…ƒã§ãã‚‹ã€‚

## æ¤œè¨¼

```python
bond_dims = (3, 5)
tt_list = TT(Z, bond_dims)

Z1 = np.einsum("ia,ajb,kb->ijk", *tt_list)
np.allclose(Z, Z1)
```

> True

ã¨ã„ã†æ„Ÿã˜ã§å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ã‚’å¾©å…ƒã§ããŸã“ã¨ã‚’æ¤œè¨¼ã§ãã‚‹ã€‚

æ¬¡ã«ã‚„ã‚„ãƒã‚¤ãƒ«ãƒ‰ãªè¿‘ä¼¼ã¨ã—ã¦ä»¥ä¸‹ã‚’å®Ÿè¡Œã™ã‚‹ã¨

```python
TT(Z, (3, 4))
```

```
array([[[ 1.26321438, -1.14774143, -0.06648278,  0.99668222,  0.82531518],
        [ 1.25868211, -0.40705353, -0.19594873, -0.51807543, -0.02129007],
        [-0.92899622,  0.43582247, -0.2202511 , -0.4602378 , -0.04378048],
        [ 2.39952597,  0.37905798, -0.4648549 , -1.15462684, -0.04006905]],

       [[-0.31743688, -0.29231377,  0.18685824, -0.27675227, -0.45475438],
        [ 0.40846868,  0.25422483, -1.06232878,  1.6507073 ,  2.60095445],
        [-0.29416419, -1.23771874, -0.56291648, -0.82238419,  0.23576111],
        [ 0.76143661,  0.13403575,  0.80441711, -1.60123875, -2.16813598]],

       [[ 1.33996203, -0.30251026,  0.71982315,  1.41479121,  0.00338877],
        [-1.55201823, -0.88800813,  0.4812836 ,  0.35116944, -0.48332776],
        [ 0.0033049 , -0.22720941, -0.75998201, -1.00902456,  0.3836937 ],
        [-0.80351403,  0.80565012,  1.31412219,  1.07830678, -1.14714764]]])
```

ãã‚‰ã„ãŒå¾—ã‚‰ã‚Œã‚‹ãŒã€å…ƒã®ãƒ†ãƒ³ã‚½ãƒ«ã¨æ¯”è¼ƒã™ã‚‹ã¨ãã“ãã“è¿‘ã„ã®ãŒåˆ†ã‹ã‚‹ã¨æ€ã†ã€‚

ã‚³ã‚¢ãƒ†ãƒ³ã‚½ãƒ«åŒå£«ã®çµåˆæ¬¡å…ƒã‚’çµã£ã¦ã„ãã¨ã€ã‚³ã‚¢ãƒ†ãƒ³ã‚½ãƒ«ã®æ¬¡å…ƒã¯

> (3, 3) (3, 4, 5) (5, 5): ä½åœ§ç¸®
> (3, 3) (3, 4, 4) (5, 4): ä¸­åœ§ç¸®
> (3, 2) (2, 4, 3) (5, 3): é«˜åœ§ç¸®

ã¨ã„ã†æ„Ÿã˜ã«ãªã‚‹ã®ã§ã€ã“ã‚“ãªå°ã•ãªãƒ†ãƒ³ã‚½ãƒ«ã®åˆ†è§£ã§ã¯ã‹ãˆã£ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é‡ãŒå¢—ãˆã¦ã„ã‚‹ã®ã§åˆ†ã‹ã‚Šã«ãã„ãŒã€å¤§ãã„ãƒ†ãƒ³ã‚½ãƒ«ã§ã†ã¾ãã‚„ã‚Œã°æƒ…å ±é‡ãŒä½â†’ä¸­â†’é«˜ã§æ¸›ã‚‰ã›ãã†ãªé›°å›²æ°—ãŒè¦‹ãˆãªã„ã‚ã‘ã§ã‚‚ãªã„ã€‚

# å®Ÿè£…ä¾‹ (è«–æ–‡ãã®ã¾ã¾)

ã•ã¦ã€Qiita è¨˜äº‹ã®å®Ÿè£…ã¯ã‚ˆãè¦‹ã‚‹ã¨è«–æ–‡ã«æ›¸ã„ã¦ã‚ã‚‹å¼ãã®ã¾ã¾ã§ã¯ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹éƒ¨åˆ†ã‚‚ã‚ã‚‹ã®ã§ã€æ„šç›´ãªå®Ÿè£…ã‚‚è¡Œã£ã¦ã¿ã‚ˆã†:

```python
def TT_SVD(C: np.ndarray, r: Sequence[int]) -> list[np.ndarray]:
    """TT_SVD algorithm

    Args:
        C (np.ndarray): n-dimensional input tensor
        r (Sequence[int]): a list of bond dimensions

    Returns:
        np.ndarray: a list of core tensors of TT-decomposition
    """

    dims = C.shape
    n = len(dims)  # n-dimensional tensor
    if len(r) != n - 1:
        raise ValueError(f"{len(r)=} must be {n - 1}.")

    tt_cores = []
    for i in range(n - 1):
        if i == 0:
            ri_1 = 1
        else:
            ri_1 = r[i - 1]
        ri = r[i]
        C = C.reshape(ri_1 * dims[i], np.prod(dims[i + 1:]))
        U, S, Vh = np.linalg.svd(C, full_matrices=False)
        # approximation
        U = U[:, :ri]
        S = S[:ri]
        Vh = Vh[:ri, :]
        tt_cores.append(U.reshape(ri_1, dims[i], ri))
        C = np.diag(S) @ Vh
    tt_cores.append(C.T)
    tt_cores[0] = tt_cores[0].reshape(dims[0], r[0])
    return tt_cores
```

Qiita è¨˜äº‹ã«å€£ã£ã¦çµåˆæ¬¡å…ƒã‚’å¤–ã‹ã‚‰ `r` ã§ä¸ãˆã¦ã„ã‚‹ä»¥å¤–ã¯è¦‹ãŸç›®çš„ã«ã‚‚è«–æ–‡ãã®ã‚‚ã®ã«ãªã£ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã ã‚ã†ã‹ï¼Ÿ

ãªãŠã€Qiita ã®å®Ÿè£…ã‚‚ã“ã®å®Ÿè£…ã‚‚ãã†ã ãŒã€â€œå¢ƒç•Œæ¡ä»¶â€ ã¨ã—ã¦ $r_0 = r_d = 1$ ã‚’èª²ã—ã¦ã„ãŸã®ã§æ¬¡å…ƒãŒ 1 ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒã‚ã‚‹ã€‚ã“ã‚Œã«ã¤ã„ã¦ã¯ `squeeze` ã—ãŸã‚ˆã†ãªæ„Ÿã˜ã§æœ€åˆã‹ã‚‰è½ã—ã¦ã„ã‚‹ã€‚

ã•ã¦ã€ã“ã‚Œã¯ Qiita ã®è¨˜äº‹ç”±æ¥ã®ã‚‚ã®ã¨ä¸€è‡´ã™ã‚‹ã®ã§ã‚ã‚ã†ã‹ï¼Ÿ

## æ¤œè¨¼

```python
# strict
strict_bond_dims = (3, 5)

# medium
medium_bond_dims = (3, 4)

# loose
loose_bond_dims = (2, 3)

for bond_dims in (strict_bond_dims, medium_bond_dims, loose_bond_dims):
    tt_list = TT(Z, bond_dims)
    tt_list2 = TT_SVD(Z, bond_dims)
    for core1, core2 in zip(tt_list, tt_list2):
        print(np.allclose(core1, core2))
    print("-" * 10)
```

```
True
True
True
----------
True
True
True
----------
True
True
True
----------
```

ã¨ã„ã†ã“ã¨ã§ååˆ†ã«ä¸€è‡´ã—ãŸã€‚

# ã¾ã¨ã‚

ã‚ˆã‚Šä¸€èˆ¬ã®ãƒ†ãƒ³ã‚½ãƒ«ã«å¯¾ã™ã‚‹ Tensor-Train åˆ†è§£ã«ã¤ã„ã¦è«–æ–‡ã¨ Qiita ã®è¨˜äº‹ã‚’é€šã˜ã¦ç¢ºèªã—ãŸã€‚

è«–æ–‡ã‚’èª­ã‚€ã¨ã€ã‹ãªã‚Šã†ã£ãƒ»ãƒ»ãƒ»ã¨ãªã‚‹å†…å®¹ã§ã‚ã‚‹ãŒã€ã©ã¡ã‚‰ã‹ã¨è¨€ã†ã¨ãã†æ„Ÿã˜ã‚‹éƒ¨åˆ†ã¯ NumPy ã§è¨€ã† `reshape` ã®æ‰‹ç¶šãã‚’è‡ªç„¶è¨€èªã§ç´°ã‹ãèª¬æ˜ã—ã¦ã„ã‚‹éƒ¨åˆ†ã§ã€ã‚³ãƒ¼ãƒ‰ã«è½ã—ã¦å®Ÿè£…ã™ã‚‹ã¨ã“ã‚Œãã‚‰ã„ã®ã‚‚ã®ã®ã‚ˆã†ã§ã‚ã‚‹ã€‚

# å‚è€ƒæ–‡çŒ®

[O] [Tensor-Train Decomposition, SIAM J. Sci. Comput., 33(5), 2295â€“2317. (23 pages), I. V. Oseledets](https://www.researchgate.net/publication/220412263_Tensor-Train_Decomposition)
[S] [The density-matrix renormalization group in the age of matrix product states, arXiv:1008.3477, Ulrich Schollwoeck](https://arxiv.org/abs/1008.3477)
[T] [Rã§tensor train decomposition ã—ã¦ã¿ãŸ, Qiita, @Yh_Taguchi](https://qiita.com/Yh_Taguchi/items/0be41d2b1c0bd8ea0e6b)
