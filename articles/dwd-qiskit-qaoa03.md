---
title: "QAOA „ÇíÁú∫„ÇÅ„Å¶„Åø„Çã (3) ‚Äï HOBO „Å® QAOA „Å®„Ç∞„É©„Éï„Ç´„É©„Éº„É™„É≥„Ç∞ÂïèÈ°å"
emoji: "ü™ê"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ["Qiskit", "Python", "QUBO", "HOBO"]
published: false
---

# ÁõÆÁöÑ

blueqat „Åï„Çì„ÅÆ„Éñ„É≠„Ç∞Ë®ò‰∫ã [HOBO„ÇΩ„É´„Éê„Éº„Åß„Ç∞„É©„Éï„Ç´„É©„Éº„É™„É≥„Ç∞ÂïèÈ°å„ÇíÂäπÁéáÂåñ](https://blueqat.com/yuichiro_minato2/ae758ca8-27fe-43e8-8bdc-2171dfc3c01e) „Çí HOBO „ÇΩ„É´„Éê„Å® QAOA „ÅßËß£„ÅÑ„Å¶„Åø„Çà„ÅÜ„Å®„ÅÑ„ÅÜ„ÇÇ„ÅÆ„ÄÇ

Ê¨≤Âºµ„Å£„Å¶„ÄÅÁêÜË´ñ„Å®„ÇΩ„É´„Éê„ÅÆË©±„ÇÇÁõõ„ÇäËæº„Çì„Å†„ÅÆ„Åß„ÄÅÂâçÁΩÆ„Åç„Åå„Å®„Å¶„ÇÇÈï∑„ÅÑ„Éª„Éª„Éª„ÄÇ

# HOBO „ÇΩ„É´„Éê

**ÁêÜË´ñ**

- [arXiv:2407.16106 Tensor Network Based HOBO Solver](https://arxiv.org/abs/2407.16106)

**„ÇΩ„É´„Éê**

- [arXiv:2407.19987 HOBOTAN: Efficient Higher Order Binary Optimization Solver with Tensor Networks and PyTorch](https://arxiv.org/abs/2407.19987)

# „Åù„ÇÇ„Åù„ÇÇ QUBO „Å® HOBO „Å®„ÅØÔºü

QUBO (Quadratic Unconstrained Binary Optimization) „Å®„ÅÑ„ÅÜÁµÑ„ÅøÂêà„Çè„ÅõÊúÄÈÅ©Âåñ„ÅÆÂÆöÂºèÂåñ„Å´Áî®„ÅÑ„Çâ„Çå„ÇãÊ¶ÇÂøµ„Åå„ÅÇ„Å£„Å¶„ÄÅ‰ª•Ââç„Å´ [cuQuantum „ÅßÈÅä„Çì„Åß„Åø„Çã (6) ‚Äî ÊúÄÂ§ß„Ç´„ÉÉ„ÉàÂïèÈ°å„Å® QUBO „Å® QAOA](/derwind/articles/dwd-cuquantum06) „Åß„ÇÇÊâ±„Å£„Åü„ÄÇ

QUBO „Å®„ÅÑ„ÅÜ„ÅÆ„ÅØ„ÄÅ$n$ ÂÄã„ÅÆ„Éê„Ç§„Éä„É™Â§âÊï∞ $\bm{x}^T = (x_1, x_2, \ldots, x_n)^T \in \{0, 1\}^n$ „Åå„ÅÇ„Çã„Å®„Åó„Å¶„ÄÅÈÅ©ÂΩì„Å™ $n$ Ê¨°ÂÆüÂØæÁß∞Ë°åÂàó $Q \in \operatorname{Mat}(n; \R)$ „ÇíÁî®„ÅÑ„Å¶ **ÂÆöÊï∞È†Ö„ÇíÈô§„ÅÑ„Å¶**

$$
\begin{align*}
H (\bm{x}) = \bm{x}^T Q \bm{x}
\tag{1}
\end{align*}
$$

„Å®„ÅÑ„ÅÜÂΩ¢„ÅßË®òËø∞„Åß„Åç„Çã„ÄÇÂêÑ $x_i$ „Å´„Å§„ÅÑ„Å¶ÈÅ©ÂΩì„Å´ 0 „Åã 1 „Çí‰ª£ÂÖ•„Åó„Å¶ $H (\bm{x})$ „ÇíÊúÄÂ∞èÂåñ„Åó„Åü„ÅÑ„ÅÆ„Å†„Åå„ÄÅÁµÑ„ÅøÂêà„Çè„ÅõÊï∞„Åå $2^n$ ÈÄö„Çä„Å´„Å™„Çã„ÅÆ„Åß‰∏ÄËà¨ÁöÑ„Å´„ÅØËß£„Åè„ÅÆ„ÅåÈõ£„Åó„ÅÑ„ÄÇ

QUBO „ÅØ 2 Ê¨°Âºè„Åß„ÅÇ„Çã„Åå„ÄÅ„Åì„Çå„Å´ÂØæ„Åó„Å¶„ÄÅHOBO (Higher Order Binary Optimization) „Å®„ÅÑ„ÅÜ„ÇÇ„ÅÆ„Åå„ÅÇ„Å£„Å¶„ÄÅ3 Ê¨°‰ª•‰∏ä„ÅÆÈ†Ö„ÅåÂá∫„Å¶Êù•„Çã„ÇÇ„ÅÆ„ÇíÊåá„Åô„ÄÇHOBO „ÅØ HUBO „Å®Êõ∏„ÅÑ„Å¶„ÅÇ„ÇãÊñáÁåÆ„ÇÇ„ÅÇ„Çã„ÅÆ„ÅßÁï•Ë™û„Å´„ÅØÊ≥®ÊÑè„Åï„Çå„Åü„ÅÑ„ÄÇ

ÂæìÊù•„ÄÅHOBO „ÇíËß£„ÅèÂ†¥Âêà„Å´„ÅØ [HOBO„Åã„ÇâQUBO„Å∏„ÅÆÂ§âÊèõ](https://qiita.com/nori_autumn/items/2713bb3dc48663cb680b) „ÅÆ„Çà„ÅÜ„Å™„Éê„Ç§„Éä„É™Â§âÊï∞„ÅÆ $x^2 = x$ „Å®„ÅÑ„ÅÜÊÄßË≥™„ÇíÊ¥ªÁî®„Åô„ÇãÂΩ¢„Åß„ÄÅ„ÄåË£úÂä©ÈáèÂ≠ê„Éì„ÉÉ„Éà„Äç„Å®„ÅÑ„ÅÜ„ÇÇ„ÅÆ„ÇíÂ∞éÂÖ•„Åó„Å¶ 2 Ê¨°Âºè„Å´ËêΩ„Å®„Åô„Å®„ÅÑ„ÅÜ„ÉÜ„ÇØ„Éã„ÉÉ„ÇØ„Åå‰Ωø„Çè„Çå„Å¶„ÅÑ„Åü„ÄÇ

„Å®„Åì„Çç„Åß„ÄÅÂºè (1) „ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´„ÇÇÊõ∏„Åë„Çã„ÄÇ

$$
\begin{align*}
H (\bm{x}) = \sum_{i,j=1}^2 Q_{ij} x_i x_j
\tag{1'}
\end{align*}
$$

„Åì„ÅÆËÄÉ„Åà„ÇíÊã°Âºµ„Åô„Çã„Å®„ÄÅ„Åß„ÅØ 3 Ê¨°Âºè„Å†„Å£„Åü„ÇâÈÅ©ÂΩì„Å™ $T_{ijk} \in \R$ „ÇíÁî®„ÅÑ„Å¶

$$
\begin{align*}
H (\bm{x}) = \sum_{i,j,k=1}^3 T_{ijk} x_i x_j x_k
\tag{2}
\end{align*}
$$

„Å®Êõ∏„Åë„Çã„ÅÆ„Åß„ÅØÔºü„Å®„ÅÑ„ÅÜËÄÉ„Åà„Å´Ëá≥„Çã„ÄÇ„Åæ„Åï„Å´ [arXiv:2407.16106 Tensor Network Based HOBO Solver](https://arxiv.org/abs/2407.16106) „ÅØ„Åì„ÅÆ„Åì„Å®„Çí‰∏ªÂºµ„Åó„Å¶„ÅÑ„Å¶„ÄÅ‰∏äË®ò„ÅØ PyTorch „Åß„ÅØ

```python
H = torch.einsum("ijk,i,j,k->", T, x, x, x)
```

„ÅßÂÆüË£Ö„Åß„Åç„Çã„Åì„Å®„Åå p.6 „ÅßËø∞„Åπ„Çâ„Çå„Å¶„ÅÑ„Çã„ÄÇ„Åì„ÅÆ„Çà„ÅÜ„Å™ 3 Ê¨°Êàñ„ÅØ„Çà„ÇäÈ´òÊ¨°„ÅÆ $T_{ijk}$ „ÅØ„Äå„ÉÜ„É≥„ÇΩ„É´„Äç[^1]„Å®Âëº„Å∞„Çå„Çã„ÇÇ„ÅÆ„Åß„ÄÅÂºè (2) „ÅØ„ÉÜ„É≥„ÇΩ„É´Ë®àÁÆó[^2]„Å®„ÅÑ„ÅÜ„Åì„Å®„Å´„Å™„Çã„ÄÇ

[^1]: „ÉÜ„É≥„ÇΩ„É´„ÅØ„Çπ„Ç´„É©„Éº„ÄÅ„Éô„ÇØ„Éà„É´„ÄÅË°åÂàó„ÇíÊã°Âºµ„Åô„ÇãÊ¶ÇÂøµ„Åß„ÄÅ„Åì„Çå„Çâ„ÇíËá™ÁÑ∂„Å´ÂÜÖÂåÖ„Åô„Çã„ÄÇÈ†Ü„Å´ 0 Èöé„ÅÆ„ÉÜ„É≥„ÇΩ„É´„ÄÅ1 Èöé„ÅÆ„ÉÜ„É≥„ÇΩ„É´„ÄÅ2 Èöé„ÅÆ„ÉÜ„É≥„ÇΩ„É´„Å®Âëº„Å∂„Åì„Å®„ÇÇ„Åß„Åç„Çã„ÄÇ

[^2]: „ÉÜ„É≥„ÇΩ„É´Ë®àÁÆó„ÄÅÁâπ„Å´„Åì„Åì„Åß‰Ωø„Å£„Å¶„ÅÑ„Çã `torch.einsum` „ÅØ„ÄÅ[A. Einstein „ÅÆÁ∏ÆÁ¥ÑË®òÊ≥ï](https://ja.wikipedia.org/wiki/%E3%82%A2%E3%82%A4%E3%83%B3%E3%82%B7%E3%83%A5%E3%82%BF%E3%82%A4%E3%83%B3%E3%81%AE%E7%B8%AE%E7%B4%84%E8%A8%98%E6%B3%95)„Å´Áî±Êù•„Åô„Çã„ÄÇ$\nu=0$ „ÅÆÊôÇÈñì„ÄÅ$\nu=1,2,3$ „ÅÆÁ©∫Èñì„Å®„ÅÑ„ÅÜÊôÇÁ©∫„ÅÆ 4 Â§âÊï∞„Å´„Å§„ÅÑ„Å¶„ÄåÂÖ±Â§â„ÉÜ„É≥„ÇΩ„É´„Äç„Å®„ÄåÂèçÂ§â„ÉÜ„É≥„ÇΩ„É´„Äç„ÅÆË¶ÅÁ¥†„Çí„Åã„ÅëÂêà„Çè„Åõ„Å¶Âíå„Çí„Å®„ÇãÊìç‰Ωú„ÅåÁõ∏ÂØæÊÄßÁêÜË´ñ„Åß„ÅØ„Åó„Å∞„Åó„Å∞ÁôªÂ†¥„Åô„Çã„Åå„ÄÅÂ§ßÂ§âÁÖ©Èõë„Å™„ÅÆ„Åß„Åì„ÅÆ„Çà„ÅÜ„Å™Ë®òÊ≥ï„ÅåÂ∞éÂÖ•„Åï„Çå„Åü„ÄÇË®àÁÆóÊ©ü„ÅÆÁêÜË´ñ„Åß„ÅØ„Åì„ÅÆÂà∂Á¥Ñ„ÅåÂ§ßÂπÖ„Å´Á∑©Âíå„Åï„Çå„Åü„Çà„ÅÜ„Åß„ÄÅÊôÆÈÄö„ÅÆÂ§öÊ¨°ÂÖÉÈÖçÂàóÂêåÂ£´„ÅÆË¶ÅÁ¥†„ÅÆ„Åã„ÅëÂêà„Çè„Åõ„ÅåË®±„Åï„Çå„Çã„ÄÇÊ∞ó„Å´„Å™„ÇãÂ†¥Âêà„ÅØ„ÄÅÈñì„Å´Ë®àÈáè„ÉÜ„É≥„ÇΩ„É´„ÅåÊåü„Åæ„Å£„Å¶„ÅÑ„Å¶„ÄÅÊ∑ª„ÅàÂ≠ó„ÅÆ‰∏ä„Åí‰∏ã„Åí„ÅåË°å„Çè„Çå„Å¶„ÅÑ„Çã„Å®ÊÄù„Å£„Å¶„ÇÇËâØ„ÅÑ„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„ÄÇ

HOBO ‚Üí QUBO „Å∏„ÅÆ„É™„ÉÄ„ÇØ„Ç∑„Éß„É≥„ÇíË°å„Çè„Åö„Å´„ÉÜ„É≥„ÇΩ„É´Ë®àÁÆó„ÅßÂÆüÈöõ„Å´ HOBO „ÇíËß£„ÅèË©¶„Åø„Åå [arXiv:2407.19987 HOBOTAN: Efficient Higher Order Binary Optimization Solver with Tensor Networks and PyTorch](https://arxiv.org/abs/2407.19987) „Åß„ÅÇ„Çä„ÄÅ„ÇΩ„É´„Éê„ÅÆË©¶È®ìÂÆüË£Ö„ÅØÁèæÂú® https://github.com/ShoyaYasuda/hobotan „Å´„ÅÇ„Çã„ÄÇË´ñÊñá„Å´„ÅØÈõ£„Åó„Åù„ÅÜ„Å™„Åì„Å®„ÇÇÊõ∏„ÅÑ„Å¶„ÅÇ„Çã„Åå„ÄÅÊú¨Ë≥™ÁöÑ„Å™„ÅÆ„ÅØ„Äå„ÉÜ„É≥„ÇΩ„É´ $T_{ijk}$ „Çí„Å©„ÅÜ„ÇÑ„Å£„Å¶ÊßãÁØâ„Åô„Çã„ÅãÔºü„Äç„Å®„ÅÑ„ÅÜÈÉ®ÂàÜ„Åß„ÅÇ„Çã„ÄÇPyPI „Å´„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅØ‰∏ä„Åå„Å£„Å¶„ÅÑ„Å™„ÅÑ„ÅÆ„Åß„ÄÅ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´„Åó„Å¶„Ç§„É≥„Çπ„Éà„Éº„É´„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„ÄÇ

```sh
pip install -U git+https://github.com/ShoyaYasuda/hobotan
```

ÂâçÁΩÆ„Åç„ÅØ„Åì„Çå„Åè„Çâ„ÅÑ„Å´„Åó„Å¶„Äå„Ç∞„É©„Éï„Ç´„É©„Éº„É™„É≥„Ç∞ÂïèÈ°å„Äç„ÇíË©¶„Åó„Å´Ëß£„ÅÑ„Å¶„Åø„Åü„ÅÑ„ÄÇ

# „Ç∞„É©„Éï„Ç´„É©„Éº„É™„É≥„Ç∞ÂïèÈ°å

„Ç∞„É©„Éï„Ç´„É©„Éº„É™„É≥„Ç∞ÂïèÈ°å„Å®„ÅÑ„ÅÜ„ÅÆ„ÅØ„Ç∞„É©„ÉïÔºàÈ†ÇÁÇπ„ÄÅËæ∫Ôºâ„Å´„Åä„ÅÑ„Å¶„ÄÅËæ∫„ÅßÁπã„Åå„Å£„Åü‰∏°Á´Ø„ÅÆÈ†ÇÁÇπÂêåÂ£´„ÅåÁï∞„Å™„ÇãËâ≤„Å´„Å™„Çã„Çà„ÅÜ„Å´„ÄÅÊåáÂÆö„ÅÆÁØÑÂõ≤„ÅÆËâ≤„ÅßÂ°ó„ÇäÂàÜ„Åë„Çã„Å®„ÅÑ„ÅÜÂïèÈ°å„Åß„ÅÇ„Çã„ÄÇ

„Åæ„Åö [HOBO„ÇΩ„É´„Éê„Éº„Åß„Ç∞„É©„Éï„Ç´„É©„Éº„É™„É≥„Ç∞ÂïèÈ°å„ÇíÂäπÁéáÂåñ](https://blueqat.com/yuichiro_minato2/ae758ca8-27fe-43e8-8bdc-2171dfc3c01e) „ÅÆ HOBO „ÇΩ„É´„Éê„Åß„ÅÆËß£Ê≥ï„ÇíÁú∫„ÇÅ„Åü„ÅÑ„ÄÇ„Åì„Åì„Åß„ÅØ 5 È†ÇÁÇπ„Çí 4 Ëâ≤„ÅßÂ°ó„ÇäÂàÜ„Åë„ÇãÂïèÈ°å„ÇíÊâ±„Å£„Å¶„ÅÑ„Çã„ÄÇÈ†ÇÁÇπ„ÅÆËæ∫„Åß„ÅÆÊé•Á∂ö„ÅØ‰ª•‰∏ã„ÅÆÈÄö„Çä„Åß„ÅÇ„Çã:

![](/images/dwd-qiskit-qaoa03/001.png =500x)

## HOBO „ÅßËß£„Åè

ÂøÖË¶Å„Å™„É¢„Ç∏„É•„Éº„É´„Çí import „Åô„Çã:

```python
from __future__ import annotations

from hobotan import (
    symbols, symbols_list, symbols_nbit, sampler, Auto_array, Compile
)
```

‰ªäÂõû„ÅØÊï¥Êï∞„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Å®„ÅÑ„ÅÜÊâãÊ≥ï„ÇíÁî®„ÅÑ„Å¶„ÅÇ„Çã„ÄÇ„Å§„Åæ„Çä„ÄÅÈáèÂ≠ê„Éì„ÉÉ„Éà $q_0$ „Å® $q_1$ „ÇíÁî®„ÅÑ„Å¶ 4 Ëâ≤ (0, 1, 2, 3) „ÇíË°®Áèæ„Åó„Å¶„ÅÑ„Çã„ÄÇ‰æã„Åà„Å∞„ÄÅËâ≤ 2 „ÅØ 2 ÈÄ≤Êï∞„ÅßË°®Áèæ„Åô„Çã„Å® `10` „Åß„ÅÇ„Çã„ÅÆ„Åß $q_1 = 1$, $q_0 = 0$ „Å®Á¨¶Âè∑Âåñ„Åß„Åç„Çã„ÅÑ„Å£„ÅüÂΩ¢„Åß„ÅÇ„Çã„ÄÇ

‰ª•‰∏ã„Åß„ÅØ„Ç™„É™„Ç∏„Éä„É´„ÅÆ„Ç≥„Éº„Éâ„Å´Âä†„Åà„ÄÅËâ≤„ÅÆÂá∫Âäõ„Å® OK „Åã„Å©„ÅÜ„Åã„ÅÆÂà§ÂÆö„ÇíÂä†„Åà„Åü„ÄÇ

```python
%%time

q = symbols_list(10, 'q{}')

# A(0, 1), B(2, 3), C(4, 5), D(6, 7), E(8, 9)
H =  ((q[0] - q[2])**2 -1)**2 * ((q[1] - q[3])**2 -1)**2 #AB
H +=  ((q[0] - q[6])**2 -1)**2 * ((q[1] - q[7])**2 -1)**2 #AD
H +=  ((q[2] - q[6])**2 -1)**2 * ((q[3] - q[7])**2 -1)**2 #BD
H +=  ((q[2] - q[4])**2 -1)**2 * ((q[3] - q[5])**2 -1)**2 #BC
H +=  ((q[2] - q[8])**2 -1)**2 * ((q[3] - q[9])**2 -1)**2 #BE
H +=  ((q[4] - q[8])**2 -1)**2 * ((q[5] - q[9])**2 -1)**2 #CE
H +=  ((q[6] - q[8])**2 -1)**2 * ((q[7] - q[9])**2 -1)**2 #DE

hobo, offset = Compile(H).get_hobo()
print(f'offset\n{offset}')

solver = sampler.SASampler(seed=0)
result = solver.run(hobo, shots=100)

for r in result[:5]:
    print(r)
    arr, subs = Auto_array(r[0]).get_ndarray('q{}')
    q0, q1, q2, q3, q4, q5, q6, q7, q8, q9 = arr
    A = 2 * q1 + q0
    B = 2 * q3 + q2
    C = 2 * q5 + q4
    D = 2 * q7 + q6
    E = 2 * q9 + q8
    ok = (A != B) and (A != D) and (B != D) and (B != C) and \
         (B != E) and (C != E) and (D != E)
    print(arr, f"{A=} {B=} {C=} {D=} {E=} {ok=}")
```

„Åì„Çå„ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™Âá∫Âäõ„Å´„Å™„Çã„ÄÇ

> offset
> 7.0
> [{'q0': 0, 'q1': 0, 'q2': 0, 'q3': 1, 'q4': 0, 'q5': 0, 'q6': 1, 'q7': 0, 'q8': 1, 'q9': 1}, -7.0, 3]
> [0 0 0 1 0 0 1 0 1 1] A=0 B=2 C=0 D=1 E=3 ok=True
> [{'q0': 1, 'q1': 0, 'q2': 0, 'q3': 0, 'q4': 1, 'q5': 0, 'q6': 0, 'q7': 1, 'q8': 1, 'q9': 1}, -7.0, 4]
> [1 0 0 0 1 0 0 1 1 1] A=1 B=0 C=1 D=2 E=3 ok=True
> [{'q0': 1, 'q1': 0, 'q2': 0, 'q3': 0, 'q4': 1, 'q5': 0, 'q6': 1, 'q7': 1, 'q8': 0, 'q9': 1}, -7.0, 1]
> [1 0 0 0 1 0 1 1 0 1] A=1 B=0 C=1 D=3 E=2 ok=True
> [{'q0': 1, 'q1': 0, 'q2': 0, 'q3': 0, 'q4': 1, 'q5': 1, 'q6': 1, 'q7': 1, 'q8': 0, 'q9': 1}, -7.0, 1]
> [1 0 0 0 1 1 1 1 0 1] A=1 B=0 C=3 D=3 E=2 ok=True
> [{'q0': 1, 'q1': 0, 'q2': 0, 'q3': 1, 'q4': 1, 'q5': 0, 'q6': 0, 'q7': 0, 'q8': 1, 'q9': 1}, -7.0, 1]
> [1 0 0 1 1 0 0 0 1 1] A=1 B=2 C=1 D=0 E=3 ok=True
> CPU times: user 19.5 s, sys: 6.64 ms, total: 19.5 s
> Wall time: 19.5 s

Â§âÊï∞ `H` „Çí‰∏πÂøµ„Å´Â±ïÈñã„Åô„Çã„Å®ÂàÜ„Åã„Çã„Åå„ÄÅÈáèÂ≠ê„Éì„ÉÉ„Éà„Å´„Å§„ÅÑ„Å¶ 4 Ê¨°„ÅÆÈ†Ö„ÅåÁèæ„Çå„Å¶„Åä„Çä„ÄÅHOBO Âºè„Å´„Å™„Å£„Å¶„ÅÑ„Çã„ÄÇ„ÇΩ„É´„Éê„Å´ÊäïÂÖ•„Åô„ÇãÂâç„Å´ QUBO „Å∏„ÅÆ„É™„ÉÄ„ÇØ„Ç∑„Éß„É≥„Çí„Åõ„Åö„Å®„ÇÇËß£„Åë„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÅÇ„Çã„ÄÇ

## QAOA „ÅßËß£„Åè

QAOA „Åß„ÇÇ `Rzzz` „Ç≤„Éº„Éà„Å™„Å©„Çí‰Ωú„Çã„Åì„Å®„Åß HOBO „ÇíÁõ¥Êé•Êâ±„Åà„Çã„Åå„ÄÅ‰ªäÂõû„ÅØÊï¢„Åà„Å¶ QUBO „ÇíÊâ±„Å£„Å¶„Åø„Åü„ÅÑ„ÄÇ„Åì„ÅÆÂ†¥Âêà„ÄÅÊâ±„ÅÑ„ÅåÂ∞ë„Åó„ÇÑ„ÇÑ„Åì„Åó„Åè„Å™„Çã„Åü„ÇÅ„ÄÅ„Åæ„Åö„ÅØÂ∞è„Åï„Å™ÂïèÈ°å„ÇíËß£„Åç„Åü„ÅÑ„ÄÇ**È†ÇÁÇπ„Çí 4 „Å§„Å´Ê∏õ„Çâ„Åó**„ÄÅ4 Ëâ≤„Åß„ÅÆÂ°óÂàÜ„Åë„ÇíËÄÉ„Åà„Çã„ÄÇÈ†ÇÁÇπ„ÅÆÊé•Á∂ö„ÅØ‰ª•‰∏ã„Å®„Åô„Çã„ÄÇ

![](/images/dwd-qiskit-qaoa03/002.png =500x)

‰ªäÂõû„ÄÅColab ‰∏ä„Åß T4 „ÇíÁî®„ÅÑ„Å¶Ë®àÁÆó„ÇíË°å„ÅÑ„Åü„ÅÑ„ÄÇ„ÇÑ„ÇÑË®àÁÆó„ÅåÂ§ß„Åç„ÅÑ„ÇÇ„ÅÆ„Åå„ÅÇ„Çã„ÅÆ„Åß GPU „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Çí‰Ωø„ÅÑ„Åü„ÅÑ„ÅÆ„Å†„ÄÇ

ÂøÖË¶Å„Å™„É¢„Ç∏„É•„Éº„É´„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´:

```sh
pip install -qU qiskit qiskit[visualization] qiskit-aer-gpu
```

Âøµ„ÅÆ„Åü„ÇÅÈáçË¶Å„Å™„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆ„Éê„Éº„Ç∏„Éß„É≥„ÇíË°®Á§∫„Åó„Å¶„Åä„Åè„ÄÇ

```sh
%%bash

pip list | egrep -e "(qiskit|hobotan)"
```

> hobotan                          0.0.8
> qiskit                           1.1.1
> qiskit-aer-gpu                   0.14.2

ËøΩÂä†„Åß„É¢„Ç∏„É•„Éº„É´„Çí import „Åô„Çã:

```python
import pprint
import re
import sys
import time

import numpy as np
import scipy as sp
import numpy.random as nr
from scipy.optimize import minimize

import matplotlib.pyplot as plt

from qiskit import QuantumCircuit
from qiskit.circuit import ParameterVector
from qiskit.quantum_info import SparsePauliOp
from qiskit.circuit.gate import Gate
from qiskit.circuit.library import RYGate
from qiskit_aer import AerSimulator
from qiskit_aer.primitives import EstimatorV2
from qiskit_aer.quantum_info import AerStatevector
```

### QUBO „Åß„ÅÆÂÆöÂºèÂåñ

ÈáèÂ≠ê„Éì„ÉÉ„Éà„Å®„Åó„Å¶ 2 Ê¨°ÂÖÉ„ÅÆ $q_{v,i}$ „ÇíËÄÉ„Åà„Çã„ÄÇ$v$ „ÅØÈ†ÇÁÇπ„ÅÆÁï™Âè∑„Åß„ÄÅ‰ªäÂõû 0, 1, 2, 3 „Åß„ÅÇ„Çã„ÄÇ$i$ „ÅØËâ≤„ÅÆÁï™Âè∑„Åß„ÄÅ„Åì„Å°„Çâ„ÇÇ‰ªäÂõû„ÅØ 0, 1, 2, 3 „Åß„ÅÇ„Çã„ÄÇÈ†ÇÁÇπ $v$ „ÅåËâ≤ $i$ „ÅßÂ°ó„Çâ„Çå„ÇãÊôÇ„Å´ $q_{v,i} = 1$ „Å®„Å™„Çä„ÄÅ„Åù„Çå‰ª•Â§ñ„Åß„ÅØ $q_{v,i} = 0$ „Å®„Åô„Çã„ÄÇ

Âêå„ÅòÈ†ÇÁÇπ $v$ „Å´„Åä„ÅÑ„Å¶„ÅØËâ≤„ÅØ„Åü„Å† 1 „Å§Ê±∫„Åæ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„ÅÆ„Åß„ÉØ„É≥„Éõ„ÉÉ„ÉàÂà∂Á¥Ñ

$$
\begin{align*}
\left(\sum_{i=0}^3 q_{v,i} - 1\right)^2
\end{align*}
$$

„ÇíË®≠ÂÆö„Åô„Çã„ÄÇ„Ç≥„Éº„Éâ„Åß„ÅØ `HA` „ÅåÂØæÂøú„Åô„Çã„ÄÇ
Ëæ∫ $(u, v)$ „ÅßÊé•Á∂ö„Åï„Çå„ÅüÈ†ÇÁÇπÂêåÂ£´„ÅåÂêå„ÅòËâ≤ $i$ „ÅßÂ°ó„Çâ„Çå„Çã„Åì„Å®„ÇíÁ¶ÅÊ≠¢„Åó„Åü„ÅÑ„ÅÆ„Åß„ÄÅ$q_{u,i} q_{v,i}$ „Å´„Éö„Éä„É´„ÉÜ„Ç£„ÇíË®≠ÂÆö„Åó„Åü„ÅÑ„ÄÇÈ†ÇÁÇπ„ÅÆÊé•Á∂ö„ÅÆÈõÜÂêà $E = {(u, v)}$ „ÇíËÄÉ„Åà‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™„Ç≥„Çπ„Éà

$$
\begin{align*}
\sum_{u, v \in E} \sum_{i=0}^3 q_{u,i} q_{v,i}
\end{align*}
$$

„ÇíË®≠ÂÆö„Åô„Çã„ÄÇ„Ç≥„Éº„Éâ„Åß„ÅØ `HB` „ÅåÂØæÂøú„Åô„Çã„ÄÇ

```python
%%time

n_vertices = 4
n_colors = 4

# vertex (v=A, B, C, D), color (m=0, 1, 2, 3)
q = symbols_list([n_vertices, n_colors], 'q{}_{}')

# „ÉØ„É≥„Éõ„ÉÉ„ÉàÂà∂Á¥Ñ
HA = 0
for v in range(n_vertices):
    HA += (1 - sum(q[v][i] for i in range(n_colors))) ** 2

# Êé•Á∂ö„Åï„Çå„ÅüÈ†ÇÁÇπÈñì„ÅÆËâ≤„ÅåÂêå‰∏Ä„ÅÆÂ†¥Âêà„Å´Â§ß„Åç„Åè„Å™„Çã„Ç≥„Çπ„ÉàÈñ¢Êï∞
HB = 0
E = [(0, 1), (0, 2), (1, 2), (1, 3), (2, 3)]  # AB, AC, BC, BD, CD
for u, v in E:
    for i in range(n_colors):
        HB += q[u][i] * q[v][i]
```

### QUBO „Åã„Çâ„Ç§„Ç∏„É≥„Ç∞„Éè„Éü„É´„Éà„Éã„Ç¢„É≥„Å∏„ÅÆÂ§âÊèõ

[cuQuantum „ÅßÈÅä„Çì„Åß„Åø„Çã (6) ‚Äî ÊúÄÂ§ß„Ç´„ÉÉ„ÉàÂïèÈ°å„Å® QUBO „Å® QAOA](/derwind/articles/dwd-cuquantum06) „Åß„ÇÇËß¶„Çå„Åü„Åå„ÄÅ„Åì„ÅÆ QUBO Âºè„Çí $z_i = 1 - 2q_i$ „Å®„ÅÑ„ÅÜÂ§âÊï∞Â§âÊèõ„Å´„Çà„Çä„ÄÅ$z_i$ „ÇíÁî®„ÅÑ„Åü„Ç§„Ç∏„É≥„Ç∞„Éè„Éü„É´„Éà„Éã„Ç¢„É≥„Å´ÁΩÆ„ÅçÊèõ„Åà„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„ÄÇ

ÂÆüË£Ö„ÅÆË©≥Á¥∞„ÅØÂâ≤ÊÑõ„Åô„Çã„Åå„ÄÅhobotan „ÅÆÈñ¢Êï∞„ÇíÊµÅÁî®„Åó„Å§„Å§‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™Â§âÊèõÈñ¢Êï∞„Çí‰ΩúÊàê„Åó„Åü:

```python
import symengine
from sympy import Rational
from hobotan.compile import replace_function


def get_hobo(H):

    #Âºè„ÇíÂ±ïÈñã„Åó„Å¶ÂêåÈ°ûÈ†Ö„Çí„Åæ„Å®„ÇÅ„Çã
    expr = symengine.expand(H)

    #‰∫å‰πóÈ†Ö„Çí‰∏Ä‰πóÈ†Ö„Å´Â§âÊèõ
    expr = replace_function(expr, lambda e: isinstance(e, symengine.Pow) and e.exp == 2, lambda e, *args: e)

    #ÊúÄÈ´òÂ≠óÊï∞„ÇíË™ø„Åπ„Å™„Åå„Çâ„Ç™„Éï„Çª„ÉÉ„Éà„ÇíË®òÈå≤
    #È†Ö„Å´ÂàÜËß£
    members = str(expr).split(' ')

    #ÂêÑÈ†Ö„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    offset = 0
    ho = 0
    for member in members:
        #Êï∞Â≠óÂçò‰Ωì„Å™„Çâ„Ç™„Éï„Çª„ÉÉ„Éà
        try:
            offset += float(member) #„Ç®„É©„Éº„Å™„Åë„Çå„Å∞Êï∞Â≠ó
        except:
            pass
        #'*'„ÅßÂàÜËß£
        texts = member.split('*')
        #‰øÇÊï∞„ÇíÂèñ„ÇäÈô§„Åè
        try:
            texts[0] = re.sub(r'[()]', '', texts[0]) #'(5/2)'„Åø„Åü„ÅÑ„Å™„ÅÆ„ÇÇÊù•„Çã
            float(Rational(texts[0])) #ÂàÜÊï∞„ÇÇÂØæÂøú #„Ç®„É©„Éº„Å™„Åë„Çå„Å∞‰øÇÊï∞„ÅÇ„Çä
            texts = texts[1:]
        except:
            pass

        if len(texts) > ho:
            ho = len(texts)
    # print(ho)

    #„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÂêåÈ°ûÈ†Ö„Çí„Åæ„Å®„ÇÅ„Çã
    expr = symengine.expand(expr)

    coeff_dict = expr.as_coefficients_dict()

    hobo = {}
    for key, value in coeff_dict.items():
        if key.is_Number:
            continue
        tmp = str(key).split('*')
        hobo[tuple(sorted(tmp))] = float(value)

    return hobo


def hobo2ising(hobo: dict[tuple[str, ...], float]) -> dict[tuple[int, ...], float]:
    expr = 0
    for key, value in hobo.items():
        term = value
        for k in key:
            # s = 1 - 2x <==> x = (1 - s) / 2
            vertex, color = [int(v) for v in k[1:].split("_")]
            term = term * (1 - symengine.symbols(str(n_colors * vertex + color))) / 2
        expr += term
    expr = symengine.expand(expr)

    coeff_dict = expr.as_coefficients_dict()

    ising = {}
    for key, value in coeff_dict.items():
        if key.is_Number:
            continue
        tmp = str(key).split('*')
        new_key = tuple(sorted(int(k) for k in sorted(tmp)))
        ising[new_key] = float(value)

    return ising
```

„Åì„Çå„ÇíÁî®„ÅÑ„Å¶ QUBO „Çí„Ç§„Ç∏„É≥„Ç∞„Éè„Éü„É´„Éà„Éã„Ç¢„É≥„Å´Â§âÊèõ„Åô„Çã„ÄÇÁõ¥Âæå„Å´Êõ∏„ÅèÁêÜÁî±„Åß„ÄÅ‰ªäÂõû„ÅØ `HA` „ÅØÂÆöÁæ©„Åó„Åü„ÇÇ„ÅÆ„ÅÆ„Åì„Çå„ÅØÁî®„ÅÑ„Åö„Å´ `HB` „Å†„ÅëÂ§âÊèõ„Åô„Çã„ÄÇ4 È†ÇÁÇπ 4 Ëâ≤„Å™„ÅÆ„Åß„ÄÅ$4 \times 4 = 16$ ÂÄã„ÅÆÈáèÂ≠ê„Éì„ÉÉ„Éà„Å∏„ÅÆÂØæÂøú„Å®„Å™„Çã„ÄÇ`(0, 4): 0.25` „Å™„Å©„ÅØ„ÄÅ$0.25 z_0 z_4$ „Å´ÂØæÂøú„Åô„Çã„ÄÇ

```python
hobo = get_hobo(HB)
ising = hobo2ising(hobo)
pprint.pprint(ising)
```


> {(0,): -0.5,
>  (0, 4): 0.25,
>  (0, 8): 0.25,
>  (1,): -0.5,
>  (1, 5): 0.25,
>  (1, 9): 0.25,
>  (2,): -0.5,
>  (2, 6): 0.25,
>  (2, 10): 0.25,
>  (3,): -0.5,
>  (3, 7): 0.25,
>  (3, 11): 0.25,
>  (4,): -0.75,
>  (4, 8): 0.25,
>  (4, 12): 0.25,
>  (5,): -0.75,
>  (5, 9): 0.25,
>  (5, 13): 0.25,
>  (6,): -0.75,
>  (6, 10): 0.25,
>  (6, 14): 0.25,
>  (7,): -0.75,
>  (7, 11): 0.25,
>  (7, 15): 0.25,
>  (8,): -0.75,
>  (8, 12): 0.25,
>  (9,): -0.75,
>  (9, 13): 0.25,
>  (10,): -0.75,
>  (10, 14): 0.25,
>  (11,): -0.75,
>  (11, 15): 0.25,
>  (12,): -0.5,
>  (13,): -0.5,
>  (14,): -0.5,
>  (15,): -0.5}


„Å®„Åì„Çç„Åß„ÄÅÈÄöÂ∏∏„ÅØ `H = HA + HB` „ÅåÊúÄÂ∞è„Å®„Å™„Çã„Çà„ÅÜ„Å´ÊúÄÈÅ©Âåñ„Çí„Åô„Çã„ÅÆ„Å†„Åå„ÄÅ‰ªäÂõû„ÅØ„ÄÅ`HA` „ÅÆ„ÉØ„É≥„Éõ„ÉÉ„ÉàÂà∂Á¥Ñ„ÅåËá™ÂãïÁöÑ„Å´Ê∫Ä„Åü„Åï„Çå„Çã„Çà„ÅÜ„Å´„Åó„Å¶ `HB` „Å†„Åë„ÅÆÊúÄÈÅ©Âåñ„Å´ÊåÅ„Å°Ëæº„Åø„Åü„ÅÑ„ÄÇ„Åì„ÅÆ„Åü„ÇÅ„Å´„ÅØ XY-mixer „Å®„ÅÑ„ÅÜ„ÇÇ„ÅÆ„Åå‰Ωø„Åà„Çã„ÄÇc.f [arXiv:1904.09314 $XY$-mixers: analytical and numerical results for QAOA](https://arxiv.org/abs/1904.09314)

XY-mixer „ÅØÂ§ßÈõëÊää„Å´„ÅØ„ÄÅ2 ÈáèÂ≠ê„Éì„ÉÉ„Éà„ÅÆÂ†¥Âêà„Å†„Å® $\frac{1}{\sqrt{2}} (\ket{01} + \ket{10})$ „ÅÆÁä∂ÊÖã„ÇíÁ∂≠ÊåÅ„Åï„Åõ„Çã„Åü„ÇÅ„Å´Áî®„ÅÑ„Çâ„Çå„Çã„ÄÇË©≥„Åó„ÅÑË™¨Êòé„ÅØ [blueqat„ÅßXY„Éü„Ç≠„Çµ„Éº„ÇíÁî®„ÅÑ„ÅüÂà∂Á¥Ñ‰ªò„ÅçQAOA](https://qiita.com/ryuNagai/items/1836601f4d3c5ec9e336) „Å™„Å©„Å´„ÅÇ„Çã„ÄÇ

3 ÈáèÂ≠ê„Éì„ÉÉ„Éà„ÅÆÂ†¥Âêà„Å´„ÅØ $\frac{1}{\sqrt{3}} (\ket{001} + \ket{010} + \ket{100})$„ÄÅ4 ÈáèÂ≠ê„Éì„ÉÉ„Éà„ÅÆÂ†¥Âêà„Å´„ÅØ $\frac{1}{2} (\ket{0001} + \ket{0010} + \ket{0100} + \ket{1000})$ „ÇíÁ∂≠ÊåÅ„Åß„Åç„Çã„ÅÆ„Åß„ÅÇ„Çå„Å∞„ÉØ„É≥„Éõ„ÉÉ„ÉàÂà∂Á¥Ñ„ÅØËá™ÂãïÁöÑ„Å´Ê∫Ä„Åü„Åï„Çå„Çã„ÅÆ„Åß„ÅÇ„Çã„ÄÇ„Åì„ÅÆ„Çà„ÅÜ„Å™Áä∂ÊÖã„Çí Dicke Áä∂ÊÖã„Å®Âëº„Å∂„Åå„ÄÅ„Åì„Çå„Çâ„ÅÆÁä∂ÊÖã„ÇíÊ∫ñÂÇô„Åô„ÇãÊñπÊ≥ï„Åå [arXiv:1904.07358 Deterministic Preparation of Dicke States](https://arxiv.org/abs/1904.07358) „ÅßÁü•„Çâ„Çå„Å¶„ÅÑ„Çã„ÄÇ

### Dicke Áä∂ÊÖã„ÅÆ‰ΩúÊàê

Ë©≥Á¥∞„ÅØË´ñÊñá„Å´Âßî„Å≠„Çã„Å®„Åó„Å¶ÂÆüË£Ö„ÅØ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´„Å™„Çã:

```python
def CCRYGate(theta: float) -> Gate:
    return RYGate(theta).control(2)


# https://arxiv.org/pdf/1904.07358 Figure 2.
def SCSn(num_qubits: int, first_block: bool = False):
    qc = QuantumCircuit(num_qubits)
    denominator = num_qubits + 1 if first_block else num_qubits

    for i, loc in enumerate(range(num_qubits - 2, -1, -1)):
        qc.cx(loc, num_qubits - 1)
        if loc + 1 == num_qubits - 1:
            qc.cry(2 * np.arccos(np.sqrt((i + 1) / denominator)), num_qubits - 1, loc)
        else:
            qc.append(CCRYGate(2 * np.arccos(np.sqrt((i + 1) / denominator))), [num_qubits - 1, loc + 1, loc])
        qc.cx(loc, num_qubits - 1)
    return qc


def make_dicke_circuit(n: int, k: int) -> QuantumCircuit:
    """make a Dicke circuit

    Andreas B√§rtschi, Stephan Eidenbenz, Deterministic Preparation of Dicke States,
    https://arxiv.org/abs/1904.07358

    Args:
        n: number of qubits
        k: Hamming weight

    Returns:
        QuantumCircuit: a quantum circuit
    """

    if n < 2:
        raise ValueError(f"n ({n}) must be equal to or greater than 2.")
    if n < k:
        raise ValueError(f"n ({n}) must be equal to or greater than k ({k}).")

    dicke = QuantumCircuit(n)
    dicke.x(dicke.qregs[0][n-k:n])

    block = SCSn(n - 1, first_block=True)
    dicke = dicke.compose(block, range(1, n))

    for m in range(max(n - 1, 2), 1, -1):
        block = SCSn(m)
        dicke = dicke.compose(block, range(m))
    
    return dicke
```

‰ªäÂõûÊ¨≤„Åó„ÅÑ„Ç±„Éº„Çπ„Å†„Å®ÂêÑÈ†ÇÁÇπ„Å´„Åä„ÅÑ„Å¶ 4 Ëâ≤„ÅÆ„ÅÜ„Å°„ÅÆ 1 Ëâ≤„ÅåÈÅ∏„Å∞„Çå„Å¶Ê¨≤„Åó„ÅÑ„ÅÆ„Åß‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™„ÇÇ„ÅÆ„Å®„Å™„Çã:

```python
dicke = make_dicke_circuit(4, 1)
display(dicke.draw("mpl", style="clifford", scale=0.7, fold=-1))
display(AerStatevector(dicke).draw("latex"))
```

![](/images/dwd-qiskit-qaoa03/003.png =500x)

$$
\begin{align*}
\frac{1}{2} (\ket{0001} + \ket{0010} + \ket{0100} + \ket{1000})
\end{align*}
$$
